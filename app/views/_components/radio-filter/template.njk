
{%- from "govuk/components/fieldset/macro.njk" import govukFieldset -%}
{%- from "govuk/components/label/macro.njk" import govukLabel -%}
{%- from "govuk/components/hint/macro.njk" import govukHint -%}
{%- from "govuk/components/error-message/macro.njk" import govukErrorMessage -%}

{#- If an id 'prefix' is not passed, fall back to using the name attribute
  instead. We need this for error messages and hints as well -#}
{% set idPrefix = params.idPrefix if params.idPrefix else params.name %}

{#- a record of other elements that we need to associate with the input using
  aria-describedby â€“ for example hints or error messages -#}
{% set describedBy = params.fieldset.describedBy if params.fieldset.describedBy else "" %}

{#- fieldset is false by default -#}
{% set hasFieldset = true if params.fieldset else false %}

<div class="app-list-filter {{- ' ' + params.classes if params.classes }}" {%- for attribute, value in params.attributes %} {{ attribute }}="{{ value }}"{% endfor %}>

  <div class="govuk-form-group">

    {%- call govukFieldset({
      legend: {
        text: params.legend.text,
        html: params.legend.html,
        isPageHeading: params.legend.isPageHeading,
        classes: params.legend.classes | default('govuk-fieldset__legend--s')
      }
    }) -%}

      {%- if params.selectedItems.length -%}
        <div class="app-list-filter__selected">
          <ul class="app-list-filter__tags">
            {%- for item in params.selectedItems -%}
              <li>
                <a class="app-list-filter__tag" href="{{ item.href }}">
                  <span class="govuk-visually-hidden">Remove this filter</span> {{ item.text }}
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </div>
      {%- endif -%}

      <div class="app-list-filter__container {% if params.maxHeight %}app-list-filter__container--max{% endif %}">

        <div class="govuk-radios app-list-filter__container-inner">

          {%- for item in params.items -%}

            {#- If the user explicitly sets an id, use this instead of the regular idPrefix -#}
            {%- if item.id -%}
              {%- set id = item.id -%}
            {%- else -%}
              {#- The first id should not have a number suffix so it's easy to link to from the error summary component -#}
              {%- if loop.first -%}
                {%- set id = idPrefix %}
              {% else %}
                {%- set id = idPrefix + "-" + loop.index -%}
              {%- endif -%}
            {%- endif -%}
            {% set name = item.name if item.name else params.name %}
            {% set conditionalId = "conditional-" + id %}

            {% set isChecked = item.checked | default((item.value == params.value and item.checked != false) if params.value else false, true) %}
            {% set hasHint = true if item.hint.text or item.hint.html %}
            {% set itemHintId = id + "-item-hint" if hasHint else "" %}
            {% set itemDescribedBy = describedBy if not hasFieldset else "" %}
            {% set itemDescribedBy = (itemDescribedBy + " " + itemHintId) | trim %}

            <div class="govuk-radios__item app-list-filter__item">
              <input class="govuk-radios__input" id="{{ id }}" name="{{ name }}" type="radio" value="{{ item.value }}"
              {{-" checked" if isChecked }}
              {{-" disabled" if item.disabled }}
              {%- if item.conditional.html %} data-aria-controls="{{ conditionalId }}"{% endif -%}
              {%- if item.behaviour %} data-behaviour="{{ item.behaviour }}"{% endif -%}
              {%- if itemDescribedBy %} aria-describedby="{{ itemDescribedBy }}"{% endif -%}
              {%- for attribute, value in item.attributes %} {{ attribute }}="{{ value }}"{% endfor %}>
              {{ govukLabel({
                html: item.html,
                text: item.text,
                classes: 'govuk-radios__label' + (' ' + item.label.classes if item.label.classes),
                attributes: item.label.attributes,
                for: id
              }) | indent(6) | trim }}
              {% if hasHint %}
                {{ govukHint({
                  id: itemHintId,
                  classes: 'govuk-radios__hint' + (' ' + item.hint.classes if item.hint.classes),
                  attributes: item.hint.attributes,
                  html: item.hint.html,
                  text: item.hint.text
                }) | indent(6) | trim }}
              {% endif %}
            </div>
            {% if item.conditional.html %}
              <div class="govuk-radios__conditional {%- if not isChecked %} govuk-radios__conditional--hidden{% endif %}" id="{{ conditionalId }}">
                {{ item.conditional.html | safe }}
              </div>
            {% endif %}
          {%- endfor -%}
        </div>
      </div>
    {%- endcall -%}
  </div>
</div>
